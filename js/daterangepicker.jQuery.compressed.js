(function(a){a.widget("ux.daterangepicker",{options:{presetRanges:[],presets:{specificDate:"Specific Date",dateRange:"Date Range"},rangeStartTitle:"Start date",rangeEndTitle:"End date",nextLinkText:"Next",prevLinkText:"Prev",doneButtonText:"Done",earliestDate:Date.parse("-15years"),latestDate:Date.parse("+15years"),constrainDates:false,rangeSplitter:"-",dateFormat:"m/d/yy",closeOnSelect:true,arrows:false,appendTo:"body",onClose:function(b){},onOpen:function(b){},onChange:function(b){},datepickerOptions:null},_create:function(){var l=this;this.rangeInput=this.element;var c=this.rangeInput;var d=this.options;this.rangeInput.addClass("daterangePickerInput");var f={onSelect:function(x,w){var v=i.find(".range-start");var y=i.find(".range-end");if(i.find(".ui-daterangepicker-specificDate").is(".ui-state-active")){y.datepicker("setDate",v.datepicker("getDate"))}a(this).trigger("constrainOtherPicker");var u=b(v.datepicker("getDate"));var t=b(y.datepicker("getDate"));if(a(this).is(".range-start")){y.datepicker("option","minDate",u)}else{v.datepicker("option","maxDate",t)}if(c.length==2){c.eq(0).val(u);c.eq(1).val(t)}else{c.val((u!=t)?u+" "+d.rangeSplitter+" "+t:u)}if(d.closeOnSelect){if(!i.find("li.ui-state-active").is(".ui-daterangepicker-dateRange")&&!i.is(":animated")){l.hideRP()}}d.onChange(l)},defaultDate:+0};c.bind("change",function(){d.onChange(l)});d.datepickerOptions=a.extend(f,d.datepickerOptions);var k,j=Date.parse("today");var o,h;var s=function(t){if(!t){return null}return a.datepicker.parseDate(d.dateFormat,t)};if(c.size()==2){k=s(c.eq(0).val())||new Date;j=s(c.eq(1).val())||new Date}else{var m=c.val().split(d.rangeSplitter);k=s(a.trim(m[0]))||new Date;j=s(a.trim(m[1]))||new Date}var i=a('<div class="ui-daterangepicker ui-widget ui-helper-clearfix ui-widget-content ui-corner-all"></div>');this.rp=i;var r=(function(){var u=a('<ul class="ui-widget-content"></ul>').appendTo(i);a.each(d.presetRanges,function(){a('<li class="ui-daterangepicker-'+a(this).text().replace("/\u0020/g","")+' ui-corner-all"><a href="#">'+this.text+"</a></li>").data("dateStart",this.dateStart).data("dateEnd",this.dateEnd).appendTo(u)});var t=0;a.each(d.presets,function(v,w){a('<li class="ui-daterangepicker-'+v+" preset_"+t+' ui-helper-clearfix ui-corner-all"><span class="ui-icon ui-icon-triangle-1-e"></span><a href="#">'+w+"</a></li>").appendTo(u);t++});u.find("li").hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).click(function(){i.find(".ui-state-active").removeClass("ui-state-active");a(this).addClass("ui-state-active");l._clickActions(a(this),i,n,e);return false});return u})();function b(v){if(!v||!v.getDate()){return""}var u=v.getDate();var x=v.getMonth();var w=v.getFullYear();x++;var t=d.dateFormat;return a.datepicker.formatDate(t,v)}a.fn.restoreDateFromData=function(){if(a(this).data("saveDate")){a(this).datepicker("setDate",a(this).data("saveDate")).removeData("saveDate")}return this};a.fn.saveDateToData=function(){if(!a(this).data("saveDate")){a(this).data("saveDate",a(this).datepicker("getDate"))}return this};var n=a('<div class="ranges ui-widget-header ui-corner-all ui-helper-clearfix"><div class="range-start"><span class="title-start">Start Date</span></div><div class="range-end"><span class="title-end">End Date</span></div></div>').appendTo(i);n.find(".range-start, .range-end").datepicker(d.datepickerOptions);this.rpPickers=n;n.find(".range-start").datepicker("setDate",k);n.find(".range-end").datepicker("setDate",j);n.find(".range-start, .range-end").bind("constrainOtherPicker",function(){if(d.constrainDates){if(a(this).is(".range-start")){i.find(".range-end").datepicker("option","minDate",a(this).datepicker("getDate"))}else{i.find(".range-start").datepicker("option","maxDate",a(this).datepicker("getDate"))}}}).trigger("constrainOtherPicker");var e=a('<button class="btnDone ui-state-default ui-corner-all">'+d.doneButtonText+"</button>").click(function(){i.find(".ui-datepicker-current-day").trigger("click");l.hideRP()}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).appendTo(n);a(this.element).click(function(){l.toggleRP();return false});n.hide().find(".range-start, .range-end, .btnDone").hide();i.data("state","closed");n.find(".ui-datepicker").css("display","block");a(d.appendTo).append(i);i.wrap('<div class="ui-daterangepickercontain"></div>');if(d.arrows&&c.size()==1){var g=a('<a href="#" class="ui-daterangepicker-prev ui-corner-all" title="'+d.prevLinkText+'"><span class="ui-icon ui-icon-circle-triangle-w">'+d.prevLinkText+"</span></a>");var q=a('<a href="#" class="ui-daterangepicker-next ui-corner-all" title="'+d.nextLinkText+'"><span class="ui-icon ui-icon-circle-triangle-e">'+d.nextLinkText+"</span></a>");a(this.element).addClass("ui-rangepicker-input ui-widget-content").wrap('<div class="ui-daterangepicker-arrows ui-widget ui-widget-header ui-helper-clearfix ui-corner-all"></div>').before(g).before(q).parent().find("a").click(function(){var u=n.find(".range-start").datepicker("getDate");var t=n.find(".range-end").datepicker("getDate");var v=Math.abs(new TimeSpan(u-t).getTotalMilliseconds())+86400000;if(a(this).is(".ui-daterangepicker-prev")){v=-v}n.find(".range-start, .range-end ").each(function(){var w=a(this).datepicker("getDate");if(w==null){return false}a(this).datepicker("setDate",w.add({milliseconds:v})).find(".ui-datepicker-current-day").trigger("click")});return false}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});var p=c.parent();this.riContain=p}a(document).click(function(){if(i.is(":visible")){l.hideRP()}});i.click(function(){return false}).hide()},showRP:function(){if(this.rp.data("state")=="closed"){a(".daterangePickerInput").each(function(b,c){a(c).daterangepicker("hideRP")});this.positionRP();this.rp.fadeIn(300).data("state","open");this.options.onOpen(this)}},hideRP:function(){if(this.rp.data("state")=="open"){this.rp.fadeOut(300).data("state","closed");this.options.onClose(this)}},toggleRP:function(){if(this.rp.data("state")=="open"){this.hideRP()}else{this.showRP()}},positionRP:function(){var b=this.riContain||this.rangeInput;var f=b.offset(),d="left",e=f.left,c=a(window).width()-e-b.outerWidth();if(e>c){d="right";e=c}this.rp.parent().css(d,e).css("top",f.top+b.outerHeight())},_clickActions:function(e,d,f,b){if(e.is(".ui-daterangepicker-specificDate")){b.hide();f.show();d.find(".title-start").text(this.options.presets.specificDate);d.find(".range-start").restoreDateFromData().css("opacity",1).show(400);d.find(".range-end").restoreDateFromData().css("opacity",0).hide(400);setTimeout(function(){b.fadeIn()},400)}else{if(e.is(".ui-daterangepicker-allDatesBefore")){b.hide();f.show();d.find(".title-end").text(this.options.presets.allDatesBefore);d.find(".range-start").saveDateToData().datepicker("setDate",this.options.earliestDate).css("opacity",0).hide(400);d.find(".range-end").restoreDateFromData().css("opacity",1).show(400);setTimeout(function(){b.fadeIn()},400)}else{if(e.is(".ui-daterangepicker-allDatesAfter")){b.hide();f.show();d.find(".title-start").text(this.options.presets.allDatesAfter);d.find(".range-start").restoreDateFromData().css("opacity",1).show(400);d.find(".range-end").saveDateToData().datepicker("setDate",this.options.latestDate).css("opacity",0).hide(400);setTimeout(function(){b.fadeIn()},400)}else{if(e.is(".ui-daterangepicker-dateRange")){b.hide();f.show();d.find(".title-start").text(this.options.rangeStartTitle);d.find(".title-end").text(this.options.rangeEndTitle);d.find(".range-start").restoreDateFromData().css("opacity",1).show(400);d.find(".range-end").restoreDateFromData().css("opacity",1).show(400);setTimeout(function(){b.fadeIn()},400)}else{b.hide();d.find(".range-start, .range-end").css("opacity",0).hide(400,function(){f.hide()});var g=(typeof e.data("dateStart")=="string")?Date.parse(e.data("dateStart")):e.data("dateStart")();var c=(typeof e.data("dateEnd")=="string")?Date.parse(e.data("dateEnd")):e.data("dateEnd")();d.find(".range-start").datepicker("setDate",g).find(".ui-datepicker-current-day").trigger("click");d.find(".range-end").datepicker("setDate",c).find(".ui-datepicker-current-day").trigger("click")}}}}return false},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){this.rangeInput.removeClass("daterangePickerInput");this.rp.closest(".ui-daterangepickercontain").remove();this.rpPickers.each(function(b,c){a(c).datepicker("destroy")});a.Widget.prototype.destroy.call(this)}})})(jQuery);